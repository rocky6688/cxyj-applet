<view class="page">
  <view class="header">
    <view class="title">人员管理</view>
  </view>

  <view class="list">
    <block wx:for="{{users}}" wx:key="_id">
      <view class="item">
        <view class="item-header">
          <text class="item-title">{{item.nickName || item.username}}</text>
          <text class="item-sub">角色：{{item.roleLabel}}｜状态：{{item.statusLabel}}</text>
        </view>
        <view class="item-actions">
          <button size="mini" bindtap="startEdit" data-id="{{item._id}}">编辑</button>
          <button size="mini" type="warn" bindtap="removeUser" data-id="{{item._id}}">删除</button>
        </view>
      </view>
    </block>
  </view>

  <view class="dialog-mask" wx:if="{{deleteDialogVisible}}" catchtap="cancelDeleteDialog">
    <view class="dialog-card" catchtap="noop">
      <view class="dialog-title">停用用户</view>
      <view class="dialog-content">
        <view>将停用：{{deleteSource.name}}</view>
        <view wx:if="{{deleteEntryCount > 0}}" class="dialog-tip">该用户名下有 {{deleteEntryCount}} 条客户录入数据，请选择转移目标：</view>
        <picker wx:if="{{deleteEntryCount > 0}}" class="dialog-picker" mode="selector" range="{{transferUsers}}" range-key="name" value="{{transferIndex}}" bindchange="onTransferChange">
          <view class="picker-inner">{{(transferUsers[transferIndex] && transferUsers[transferIndex].name) || '请选择转移用户'}}</view>
        </picker>
      </view>
      <view class="dialog-actions">
        <button size="mini" bindtap="cancelDeleteDialog">取消</button>
        <button size="mini" class="primary" loading="{{deleting}}" disabled="{{deleting}}" bindtap="confirmSoftDelete">确认停用</button>
      </view>
    </view>
  </view>
</view>
