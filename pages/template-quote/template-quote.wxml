<view class="quote-container">
  <scroll-view scroll-y class="quote-scroll">
    <block wx:for="{{sections}}" wx:key="id">
      <view class="category-section">
        <view class="category-header" bindtap="toggleSection" data-section-id="{{item.id}}">
          <view class="category-select" catchtap="noop">
            <checkbox-group bindchange="onSectionSelectAllChange" data-section-id="{{item.id}}">
              <checkbox value="{{item.id}}" checked="{{sectionSelectAll[item.id]}}">全选</checkbox>
            </checkbox-group>
          </view>
          <view class="category-title">{{item.name}}</view>
          <view class="category-arrow {{expandedSections[item.id] ? 'expanded' : ''}}">▼</view>
        </view>
        <view class="items-list" wx:if="{{expandedSections[item.id]}}">
          <view class="item-row" wx:for="{{item.items}}" wx:key="id">
            <checkbox-group bindchange="onItemSelect" data-item="{{item}}">
              <checkbox value="{{item.id}}" checked="{{!!selectedItems[item.id]}}"/>
            </checkbox-group>
            <view class="item-info">
              <text class="item-name">{{item.name}}</text>
              <view class="item-price-section">
                <text class="item-price" wx:if="{{item.slug === 'stairs_fee'}}">¥{{fees.stairsFeeText}}</text>
                <text class="item-price" wx:elif="{{item.price > 0}}">¥{{item.price}}</text>
                <text class="item-price" wx:else>面议</text>
                <text class="item-unit">{{item.unit}}</text>
              </view>
            </view>
            <input class="area-input" type="text" placeholder="面积" 
                   value="{{selectedItems[item.id].areaText}}"
                   bindinput="onAreaInput" bindfocus="onAreaFocus" bindblur="onAreaBlur" data-item-id="{{item.id}}"
                   wx:if="{{(item.unit === '每平' || item.unit === '米') && selectedItems[item.id] && item.slug !== 'garbage_transport'}}"/>
            <input class="area-input" type="text" placeholder="4方车起" 
                   value="{{selectedItems[item.id].areaText}}"
                   bindinput="onAreaInput" bindfocus="onAreaFocus" bindblur="onAreaBlur" data-item-id="{{item.id}}"
                   wx:if="{{item.slug === 'garbage_transport' && selectedItems[item.id]}}"/>
            <input class="quantity-input" type="number" placeholder="数量" 
                   value="{{quantities[item.id]}}"
                   bindinput="onQuantityInput" bindfocus="onQuantityFocus" bindblur="onQuantityBlur" data-item-id="{{item.id}}"
                   wx:if="{{(item.unit === '个' || item.unit === '套' || item.unit === '单扇' || item.unit === '方车' || item.unit === '项') && selectedItems[item.id]}}"/>
            <input class="manual-price-input" type="number" placeholder="输入金额" 
                   value="{{manualPrices[item.id]}}"
                   bindinput="onManualPriceInput" bindfocus="onManualPriceFocus" data-item-id="{{item.id}}"
                   wx:if="{{(item.price === 0 || item.unit === '面议') && item.slug !== 'stairs_fee' && selectedItems[item.id]}}"/>
          </view>
        </view>
      </view>
    </block>
  </scroll-view>

  <view class="total-section">
    <view class="total-item fee stairs-toggle">
      <text>楼梯房上楼费</text>
      <radio-group bindchange="onStairsRadioChange">
        <radio value="off" checked="{{!stairsEnabled}}" style="margin-right:20rpx">不计</radio>
        <radio value="on" checked="{{stairsEnabled}}">计入</radio>
      </radio-group>
    </view>
    <view class="total-item fee">
      <text>基础总价：</text>
      <text>¥{{baseTotalText}}</text>
    </view>
    <view class="total-item fee">
      <text>设计费（2%）：</text>
      <text>¥{{fees.designFeeText}}</text>
    </view>
    <view class="total-item fee">
      <text>运输费（2%）：</text>
      <text>¥{{fees.transportFeeText}}</text>
    </view>
    <view class="total-item fee">
      <text>管理费（2%）：</text>
      <text>¥{{fees.managementFeeText}}</text>
    </view>
    <view class="total-item fee" wx:if="{{stairsEnabled}}">
      <text>楼梯房上楼费（2%）：</text>
      <text>¥{{fees.stairsFeeText}}</text>
    </view>
    <view class="total-item final">
      <text>总报价：</text>
      <text class="final-price">¥{{finalTotalText}}</text>
    </view>
  </view>
</view>